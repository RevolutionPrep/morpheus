<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>has_many_association.rb</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
        <a class="source" href="/polaris_resource/index.html">INDEX</a>
          <a class="source" href="../../ext/typhoeus.html">typhoeus.rb</a>
          <a class="source" href="../../polaris_client/associations.html">associations.rb</a>
          <a class="source" href="../../polaris_client/log_subscriber.html">log_subscriber.rb</a>
          <a class="source" href="../../polaris_client/railtie.html">railtie.rb</a>
          <a class="source" href="../../polaris_resource.html">polaris_resource.rb</a>
          <a class="source" href="association.html">association.rb</a>
          <a class="source" href="belongs_to_association.html">belongs_to_association.rb</a>
          <a class="source" href="has_many_association.html">has_many_association.rb</a>
          <a class="source" href="has_one_association.html">has_one_association.rb</a>
          <a class="source" href="../base.html">base.rb</a>
          <a class="source" href="../configuration.html">configuration.rb</a>
          <a class="source" href="../errors.html">errors.rb</a>
          <a class="source" href="../mixins/associations.html">associations.rb</a>
          <a class="source" href="../mixins/attributes.html">attributes.rb</a>
          <a class="source" href="../mixins/conversion.html">conversion.rb</a>
          <a class="source" href="../mixins/finders.html">finders.rb</a>
          <a class="source" href="../mixins/introspection.html">introspection.rb</a>
          <a class="source" href="../mixins/persistence.html">persistence.rb</a>
          <a class="source" href="../mixins/reflections.html">reflections.rb</a>
          <a class="source" href="../mixins/request_handling.html">request_handling.rb</a>
          <a class="source" href="../mixins/response_parsing.html">response_parsing.rb</a>
          <a class="source" href="../mixins/url_support.html">url_support.rb</a>
          <a class="source" href="../mock.html">mock.rb</a>
          <a class="source" href="../reflection.html">reflection.rb</a>
          <a class="source" href="../relation.html">relation.rb</a>
          <a class="source" href="../request.html">request.rb</a>
          <a class="source" href="../request_cache.html">request_cache.rb</a>
          <a class="source" href="../request_queue.html">request_queue.rb</a>
          <a class="source" href="../response.html">response.rb</a>
          <a class="source" href="../type_caster.html">type_caster.rb</a>
      </div>
    </div>
  </div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>has_many_association.rb</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">module</span> <span class="nn">PolarisResource</span>
  <span class="k">module</span> <span class="nn">Associations</span>
    <span class="k">class</span> <span class="nc">HasManyAssociation</span> <span class="o">&lt;</span> <span class="no">Association</span>
      </pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p>The initializer calls out to the superclass' initializer and then
sets the options particular to itself.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">association</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
        <span class="k">super</span>
        </pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-3">&#182;</a>
        </div>
        <p>The foreign key is used to generate the url for the association
request when the association is transformed into a relation.
The default is to use the class of the owner object with an &lsquo;_id&rsquo;
suffix.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="vi">@options</span><span class="o">[</span><span class="ss">:foreign_key</span><span class="o">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">[</span><span class="ss">:foreign_key</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@owner</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">underscore</span><span class="si">}</span><span class="s2">_id&quot;</span><span class="o">.</span><span class="n">to_sym</span>
        </pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-4">&#182;</a>
        </div>
        <p>The primary key is used in the generated url for the target. It
defaults to :id.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="vi">@options</span><span class="o">[</span><span class="ss">:primary_key</span><span class="o">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">[</span><span class="ss">:primary_key</span><span class="o">]</span> <span class="o">||</span> <span class="ss">:id</span>
      <span class="k">end</span>
      </pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p>When loading the target, the primary key is first checked. If the
key is nil, then an empty array is returned. Otherwise, the target
is requested at the generated url. For a has_many :meetings
association on a class called Course, the generated url might look
like this: /courses/1/meetings, where the 1 is the primary key.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">def</span> <span class="nf">load_target!</span>
        <span class="k">if</span> <span class="n">primary_key</span> <span class="o">=</span> <span class="vi">@owner</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="vi">@options</span><span class="o">[</span><span class="ss">:primary_key</span><span class="o">]</span><span class="p">)</span>
          <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">#{</span><span class="vi">@owner</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">plural_url_name</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">primary_key</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="vi">@association_class</span><span class="o">.</span><span class="n">plural_url_name</span><span class="si">}</span><span class="s2">&quot;</span>
          <span class="vi">@options</span><span class="o">[</span><span class="ss">:class_name</span><span class="o">].</span><span class="n">constantize</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="o">[]</span>
        <span class="k">end</span>
      <span class="k">end</span>
      </pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>The where, limit, and page methods delegate to a Relation object.
The association generates a relation, and then calls the very
same where, limit, or page method on that relation object.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">def</span> <span class="nf">where</span><span class="p">(</span><span class="n">query_attributes</span><span class="p">)</span>
        <span class="k">return</span> <span class="vi">@mock</span> <span class="k">if</span> <span class="vi">@mock</span>
        <span class="n">transform_association_into_relation</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">query_attributes</span><span class="p">)</span>
      <span class="k">end</span>
      
      <span class="k">def</span> <span class="nf">limit</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
        <span class="k">return</span> <span class="vi">@mock</span> <span class="k">if</span> <span class="vi">@mock</span>
        <span class="n">transform_association_into_relation</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
      <span class="k">end</span>
      
      <span class="k">def</span> <span class="nf">page</span><span class="p">(</span><span class="n">page_number</span><span class="p">)</span>
        <span class="k">return</span> <span class="vi">@mock</span> <span class="k">if</span> <span class="vi">@mock</span>
        <span class="n">transform_association_into_relation</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">page_number</span><span class="p">)</span>
      <span class="k">end</span>
      
      <span class="k">def</span> <span class="nf">transform_association_into_relation</span>
        <span class="no">Relation</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@association</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">constantize</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="vi">@options</span><span class="o">[</span><span class="ss">:foreign_key</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="vi">@owner</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="vi">@options</span><span class="o">[</span><span class="ss">:primary_key</span><span class="o">]</span><span class="p">))</span>
      <span class="k">end</span>
      <span class="kp">private</span> <span class="ss">:transform_association_into_relation</span>
      </pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>The append operator is used to append new resources to the association.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">def</span> <span class="nf">&lt;&lt;</span><span class="p">(</span><span class="n">one_of_many</span><span class="p">)</span>
        <span class="vi">@target</span> <span class="o">||=</span> <span class="o">[]</span>
        <span class="vi">@target</span> <span class="o">&lt;&lt;</span> <span class="n">one_of_many</span>
      <span class="k">end</span>
      
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>